<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Germana Expert - LecturÄƒ È™i Teste</title>
    <style>
        * { box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; padding: 10px; background: #f0f2f5; padding-top: 85px; }
        #top-bar { position: fixed; top: 0; left: 0; width: 100%; height: 75px; background: #28a745; color: white; 
                   display: flex; align-items: center; justify-content: center; z-index: 1000; font-weight: bold; padding: 10px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.2); font-size: 17px; }
        .card { background: white; border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .section-title { font-size: 13px; font-weight: bold; color: #666; text-transform: uppercase; margin-bottom: 10px; display: block; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 10px; }
        .btn { border: none; padding: 12px; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; font-size: 13px; }
        .btn-blue { background: #007bff; }
        .btn-purple { background: #673ab7; }
        .btn-orange { background: #fd7e14; }

        #reader-area { line-height: 2.2; font-size: 20px; color: #1a1a1a; min-height: 100px; padding: 15px 0; white-space: pre-wrap; }
        .word { cursor: pointer; padding: 2px 4px; border-radius: 4px; display: inline-block; }
        .active-word { background: #ccffcc !important; border-bottom: 2px solid #28a745; }
        
        .btn-audio { width: 100%; padding: 16px; border-radius: 8px; margin-top: 10px; font-weight: bold; border: none; font-size: 16px; }
        .play-mode { background: #343a40; color: white; }
        .stop-mode { background: #dc3545; color: white; }
        
        .item-list { background: #f8f9fa; padding: 10px; border-radius: 8px; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #ddd; }
        textarea, input { width: 100%; border-radius: 8px; border: 1px solid #ddd; padding: 10px; font-size: 15px; margin-top: 5px; }
        .hidden { display: none; }
        .btn-mini-audio { background: white; color: #28a745; border: none; border-radius: 50%; width: 30px; height: 30px; margin-left: 10px; cursor: pointer; font-size: 18px; display: inline-flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

<div id="top-bar">ApasÄƒ pe un cuvÃ¢nt sau un test</div>

<div class="card">
    <span class="section-title">ðŸ“š Biblioteca Mea</span>
    <div id="lecturi-list"></div>
    <button class="btn btn-blue" style="width:100%; margin-top:10px;" onclick="toggleSectiune('add-lectura')">+ AdaugÄƒ LecturÄƒ</button>
    <div id="add-lectura" class="hidden">
        <input type="text" id="L-titlu" placeholder="Titlu poveste...">
        <textarea id="L-text" placeholder="LipeÈ™te textul aici..."></textarea>
        <button class="btn btn-blue" style="width:100%; margin-top:5px;" onclick="salveazaLectura()">SalveazÄƒ</button>
    </div>
</div>

<div class="card">
    <span class="section-title">ðŸ§  Testele Mele (Quiz)</span>
    <div id="teste-list"></div>
    <button class="btn btn-purple" style="width:100%; margin-top:10px;" onclick="toggleSectiune('add-test')">+ CreeazÄƒ Test Nou</button>
    <div id="add-test" class="hidden">
        <input type="text" id="T-titlu" placeholder="Titlu Test (ex: Verbe A1)">
        <textarea id="T-intrebari" placeholder="Scrie Ã®ntrebarea È™i rÄƒspunsul separate prin virgulÄƒ, cÃ¢te una pe rÃ¢nd. Ex:
Hund,Caine
Katze,Pisica"></textarea>
        <button class="btn btn-purple" style="width:100%; margin-top:5px;" onclick="salveazaTest()">SalveazÄƒ Testul</button>
    </div>
</div>

<div class="card">
    <span class="section-title">ðŸ“– Cititor / Test</span>
    <div id="reader-area">SelecteazÄƒ ceva de mai sus...</div>
    <button id="btn-audio-main" class="btn-audio play-mode hidden" onclick="toggleAudioComplet()">ðŸ”Š AscultÄƒ Textul Complet</button>
</div>

<script>
    let synth = window.speechSynthesis;
    let textCurent = "";

    window.onload = () => { incarcaLecturi(); incarcaTeste(); };

    function toggleSectiune(id) { document.getElementById(id).classList.toggle('hidden'); }

    // --- LOGICÄ‚ LECTURI ---
    function salveazaLectura() {
        const titlu = document.getElementById('L-titlu').value || "Text";
        const continut = document.getElementById('L-text').value;
        if (!continut) return;
        let list = JSON.parse(localStorage.getItem('lib_lecturi') || '[]');
        list.push({ titlu, continut });
        localStorage.setItem('lib_lecturi', JSON.stringify(list));
        incarcaLecturi(); toggleSectiune('add-lectura');
    }

    function incarcaLecturi() {
        const div = document.getElementById('lecturi-list');
        let list = JSON.parse(localStorage.getItem('lib_lecturi') || '[]');
        div.innerHTML = list.map((item, i) => `
            <div class="item-list">
                <span onclick="afiseazaText(${i})" style="cursor:pointer; font-weight:bold;">ðŸ“„ ${item.titlu}</span>
                <span onclick="stergeItem('lib_lecturi', ${i}, 'L')" style="color:red; cursor:pointer;">X</span>
            </div>
        `).join('');
    }

    function afiseazaText(i) {
        let list = JSON.parse(localStorage.getItem('lib_lecturi') || '[]');
        textCurent = list[i].continut;
        document.getElementById('reader-area').innerHTML = textCurent.split(/\s+/).map(w => `<span class="word" onclick="tradu(this)">${w}</span>`).join(' ');
        document.getElementById('btn-audio-main').classList.remove('hidden');
        stopAudio();
    }

    // --- LOGICÄ‚ TESTE ---
    function salveazaTest() {
        const titlu = document.getElementById('T-titlu').value || "Test";
        const date = document.getElementById('T-intrebari').value;
        if (!date) return;
        let perechi = date.split('\n').map(linie => linie.split(',')).filter(p => p.length === 2);
        let list = JSON.parse(localStorage.getItem('lib_teste') || '[]');
        list.push({ titlu, intrebari: perechi });
        localStorage.setItem('lib_teste', JSON.stringify(list));
        incarcaTeste(); toggleSectiune('add-test');
    }

    function incarcaTeste() {
        const div = document.getElementById('teste-list');
        let list = JSON.parse(localStorage.getItem('lib_teste') || '[]');
        div.innerHTML = list.map((item, i) => `
            <div class="item-list">
                <span onclick="pornesteTest(${i})" style="cursor:pointer; color:#673ab7; font-weight:bold;">ðŸ§  ${item.titlu}</span>
                <span onclick="stergeItem('lib_teste', ${i}, 'T')" style="color:red; cursor:pointer;">X</span>
            </div>
        `).join('');
    }

    function pornesteTest(i) {
        let list = JSON.parse(localStorage.getItem('lib_teste') || '[]');
        let test = list[i].intrebari;
        let scor = 0;
        document.getElementById('btn-audio-main').classList.add('hidden');
        document.getElementById('reader-area').innerHTML = "<h3>Test pornit: " + list[i].titlu + "</h3>";
        
        for (let q of test) {
            let r = prompt(`Tradu Ã®n RomÃ¢nÄƒ: ${q[0].trim()}`);
            if (r && r.toLowerCase().trim() === q[1].toLowerCase().trim()) {
                alert("Corect! âœ…");
                scor++;
            } else {
                alert(`GreÈ™it. Era: ${q[1].trim()}`);
            }
        }
        alert(`Test finalizat! Scor: ${scor} din ${test.length}`);
    }

    // --- UTILITARE ---
    function stergeItem(key, i, tip) {
        let list = JSON.parse(localStorage.getItem(key) || '[]');
        list.splice(i, 1);
        localStorage.setItem(key, JSON.stringify(list));
        tip === 'L' ? incarcaLecturi() : incarcaTeste();
    }

    function tradu(el) {
        document.querySelectorAll('.word').forEach(w => w.classList.remove('active-word'));
        el.classList.add('active-word');
        let c = el.innerText.replace(/[.,!?;:()]/g, '');
        fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=de&tl=ro&dt=t&q=${c}`)
            .then(r => r.json()).then(data => {
                let trad = data[0][0][0];
                document.getElementById('top-bar').innerHTML = `<b>${c}</b> = ${trad} <button class="btn-mini-audio" onclick="vorbesteCuvant('${c}')">ðŸ”Š</button>`;
            });
    }

    function vorbesteCuvant(c) { stopAudio(); let u = new SpeechSynthesisUtterance(c); u.lang = 'de-DE'; synth.speak(u); }

    function toggleAudioComplet() {
        if (synth.speaking) { stopAudio(); } 
        else {
            let u = new SpeechSynthesisUtterance(textCurent);
            u.lang = 'de-DE';
            u.onstart = () => { 
                document.getElementById('btn-audio-main').innerHTML = "â¹ OpreÈ™te Citirea";
                document.getElementById('btn-audio-main').className = "btn-audio stop-mode";
            };
            u.onend = () => resetButon();
            synth.speak(u);
        }
    }

    function stopAudio() { synth.cancel(); resetButon(); }
    function resetButon() {
        let b = document.getElementById('btn-audio-main');
        b.innerHTML = "ðŸ”Š AscultÄƒ Textul Complet";
        b.className = "btn-audio play-mode";
    }
</script>
</body>
</html>
