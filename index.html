<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Germana Expert - Memorie SetÄƒri</title>
    <style>
        :root { --bg-reader: #ffffff; --font-size: 20px; }
        * { box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; padding: 10px; background: #f0f2f5; padding-top: 85px; }
        
        #top-bar { position: fixed; top: 0; left: 0; width: 100%; height: 75px; background: #28a745; color: white; 
                   display: flex; align-items: center; justify-content: space-between; z-index: 1000; font-weight: bold; padding: 0 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        
        .card { background: white; border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .section-title { font-size: 12px; font-weight: bold; color: #666; text-transform: uppercase; margin-bottom: 10px; display: block; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .btn { border: none; padding: 12px; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; font-size: 13px; text-align: center; }
        .propriu { background: #007bff; } .btn-test { background: #673ab7; }
        
        #reader-area { line-height: 1.8; font-size: var(--font-size); background: var(--bg-reader); min-height: 120px; padding: 15px; border-radius: 8px; white-space: pre-wrap; }
        .word { cursor: pointer; padding: 2px 2px; border-radius: 4px; display: inline-block; }
        .active-word { background: #ccffcc !important; border-bottom: 2px solid #28a745; }
        
        .settings-panel { display: none; position: fixed; top: 80px; left: 10px; right: 10px; background: white; z-index: 2000; border-radius: 15px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); border: 2px solid #28a745; max-height: 80vh; overflow-y: auto; }
        .item-row { display: flex; justify-content: space-between; background: #f8f9fa; padding: 12px; border-radius: 8px; margin-bottom: 6px; border: 1px solid #ddd; }
        .hidden { display: none; }
        input, textarea, select { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd; margin-top: 5px; }
    </style>
</head>
<body>

<div id="top-bar">
    <span id="status-text">Germana Pro</span>
    <button onclick="toggleSettings()" style="background:none; border:none; color:white; font-size:24px; cursor:pointer;">âš™ï¸</button>
</div>

<div id="settings-panel" class="settings-panel">
    <h3 style="margin-top:0">âš™ï¸ SetÄƒri Personalizate</h3>
    
    <div style="margin-bottom:15px;">
        <label><b>VitezÄƒ Voce:</b> <span id="speed-val">1</span>x</label>
        <input type="range" id="speed-slider" min="0.4" max="1.2" step="0.1" value="1" onchange="saveConfig()">
    </div>

    <div style="margin-bottom:15px;">
        <label><b>MÄƒrime Text:</b> <span id="font-val">20</span>px</label>
        <input type="range" id="font-slider" min="16" max="34" step="2" value="20" onchange="saveConfig()">
    </div>

    <div style="margin-bottom:15px;">
        <label><b>Culoare Fundal:</b></label>
        <select id="theme-select" onchange="saveConfig()">
            <option value="#ffffff">Alb Clasic</option>
            <option value="#f4ecd8">Sepia (Odihnitor)</option>
            <option value="#e0e0e0">Gri Soft</option>
        </select>
    </div>

    <hr>
    <div style="background: #eef9ee; padding: 10px; border-radius: 8px;">
        <label><b>ğŸ“¥ Import Rapid:</b></label>
        <textarea id="web-import-area" style="height:60px" placeholder="LipeÈ™te textul aici..."></textarea>
        <input type="text" id="web-import-title" placeholder="Titlu material">
        <div style="display:flex; gap:5px; margin-top:5px;">
            <button class="btn propriu" style="flex:1" onclick="importExtern('L')">LecturÄƒ</button>
            <button class="btn btn-test" style="flex:1" onclick="importExtern('T')">Test</button>
        </div>
    </div>

    <button class="btn" style="width:100%; margin-top:15px; background:#343a40" onclick="toggleSettings()">SalveazÄƒ È™i Ãnchide</button>
</div>

<div class="card">
    <div class="grid">
        <button class="btn propriu" style="background:#4caf50" onclick="incarcaPreset('a1')">A1</button>
        <button class="btn propriu" style="background:#ff9800" onclick="incarcaPreset('b1')">B1</button>
        <button class="btn propriu" style="background:#673ab7" onclick="incarcaPreset('c1')">C1</button>
        <button class="btn propriu" style="grid-column: span 3; margin-top:5px;" onclick="toggleSectiune('zona-adaugare')">+ AdaugÄƒ Manual</button>
    </div>
    <div id="zona-adaugare" class="hidden">
        <input type="text" id="inp-titlu" placeholder="Titlu...">
        <textarea id="inp-text" style="height:80px" placeholder="Text sau Cuvant,Traducere"></textarea>
        <div style="display:flex; gap:5px; margin-top:5px;">
            <button class="btn propriu" style="flex:1" onclick="salveaza('L')">LecturÄƒ</button>
            <button class="btn btn-test" style="flex:1" onclick="salveaza('T')">Test</button>
        </div>
    </div>
</div>

<div class="card">
    <span class="section-title">ğŸ“‚ Materiale Salvate</span>
    <div id="lista-materiale"></div>
</div>

<div class="card">
    <div id="reader-area">Alege un text...</div>
    <button id="main-audio-btn" class="btn-audio propriu hidden" onclick="controlAudio()">ğŸ”Š AscultÄƒ Tot</button>
</div>

<script>
    let synth = window.speechSynthesis;
    let textCurent = "";

    window.onload = () => {
        loadConfig();
        refreshLista();
    };

    // --- SALVARE SETÄ‚RI ---
    function saveConfig() {
        const config = {
            speed: document.getElementById('speed-slider').value,
            font: document.getElementById('font-slider').value,
            theme: document.getElementById('theme-select').value
        };
        localStorage.setItem('app_config', JSON.stringify(config));
        applyConfig(config);
    }

    function loadConfig() {
        const saved = localStorage.getItem('app_config');
        if(saved) {
            const config = JSON.parse(saved);
            document.getElementById('speed-slider').value = config.speed;
            document.getElementById('font-slider').value = config.font;
            document.getElementById('theme-select').value = config.theme;
            applyConfig(config);
        }
    }

    function applyConfig(config) {
        document.getElementById('speed-val').innerText = config.speed;
        document.getElementById('font-val').innerText = config.font;
        document.documentElement.style.setProperty('--font-size', config.font + 'px');
        document.documentElement.style.setProperty('--bg-reader', config.theme);
    }

    // --- FUNCÈšIILE EXISTENTE ---
    function toggleSettings() { let p = document.getElementById('settings-panel'); p.style.display = (p.style.display === 'block') ? 'none' : 'block'; }
    function toggleSectiune(id) { document.getElementById(id).classList.toggle('hidden'); }

    function importExtern(tip) {
        const text = document.getElementById('web-import-area').value;
        const titlu = document.getElementById('web-import-title').value || "Import";
        if(!text) return;
        let db = JSON.parse(localStorage.getItem('mea_data') || '[]');
        db.push({ titlu, continut: text, tip });
        localStorage.setItem('mea_data', JSON.stringify(db));
        refreshLista();
        alert("Salvat!");
    }

    function salveaza(tip) {
        const t = document.getElementById('inp-titlu').value || "Nou";
        const c = document.getElementById('inp-text').value;
        if(!c) return;
        let db = JSON.parse(localStorage.getItem('mea_data') || '[]');
        db.push({ titlu: t, continut: c, tip });
        localStorage.setItem('mea_data', JSON.stringify(db));
        refreshLista(); toggleSectiune('zona-adaugare');
    }

    function refreshLista() {
        const cont = document.getElementById('lista-materiale');
        let db = JSON.parse(localStorage.getItem('mea_data') || '[]');
        cont.innerHTML = db.map((item, i) => `
            <div class="item-row">
                <span onclick="deschide(${i})" style="cursor:pointer; flex:1;"><b>${item.tip == 'L' ? 'ğŸ“„' : 'ğŸ§ '} ${item.titlu}</b></span>
                <span onclick="sterge(${i})" style="color:red; cursor:pointer; font-weight:bold;">X</span>
            </div>
        `).join('');
    }

    function deschide(i) {
        let db = JSON.parse(localStorage.getItem('mea_data') || '[]');
        if(db[i].tip == 'L') afiseaza(db[i].continut);
        else runTest(db[i].continut);
    }

    function runTest(raw) {
        let p = raw.split('\n').map(l => l.split(',')).filter(x => x.length==2);
        let s = 0;
        p.forEach(q => {
            let r = prompt("Tradu: " + q[0]);
            if(r && r.toLowerCase().trim() == q[1].toLowerCase().trim()) s++;
        });
        alert("Scor: " + s + "/" + p.length);
    }

    function sterge(i) {
        if(confirm("È˜tergi?")) {
            let db = JSON.parse(localStorage.getItem('mea_data') || '[]');
            db.splice(i, 1);
            localStorage.setItem('mea_data', JSON.stringify(db));
            refreshLista();
        }
    }

    function afiseaza(t) {
        textCurent = t;
        document.getElementById('reader-area').innerHTML = t.split(/\s+/).map(w => `<span class="word" onclick="tradu(this)">${w}</span>`).join(' ');
        document.getElementById('main-audio-btn').classList.remove('hidden');
    }

    function tradu(el) {
        document.querySelectorAll('.word').forEach(w => w.classList.remove('active-word'));
        el.classList.add('active-word');
        let c = el.innerText.replace(/[.,!?;:()]/g, '');
        fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=de&tl=ro&dt=t&q=${c}`)
            .then(r => r.json()).then(data => {
                let trad = data[0][0][0];
                document.getElementById('status-text').innerHTML = `<b>${c}</b> = ${trad} <button onclick="redaSf('${c}')" style="border:none; background:white; cursor:pointer;">ğŸ”Š</button>`;
            });
    }

    function redaSf(c) { synth.cancel(); let u = new SpeechSynthesisUtterance(c); u.lang = 'de-DE'; u.rate = document.getElementById('speed-slider').value; synth.speak(u); }
    
    function controlAudio() {
        if(synth.speaking) { synth.cancel(); document.getElementById('main-audio-btn').innerText = "ğŸ”Š AscultÄƒ Tot"; }
        else {
            let u = new SpeechSynthesisUtterance(textCurent); u.lang = 'de-DE';
            u.rate = document.getElementById('speed-slider').value;
            u.onstart = () => document.getElementById('main-audio-btn').innerText = "â¹ OpreÈ™te";
            u.onend = () => document.getElementById('main-audio-btn').innerText = "ğŸ”Š AscultÄƒ Tot";
            synth.speak(u);
        }
    }

    function incarcaPreset(n) {
        const p = { 'a1': "Hallo! Ich bin aici.", 'b1': "Deutsch ist super!", 'c1': "Wunderbar!" };
        afiseaza(p[n]);
    }
</script>
</body>
</html>
